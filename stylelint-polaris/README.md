# @shopify/stylelint-polaris

A configuration of Stylelint rules that promote adoption and track coverage of the Polaris design system in consuming apps.

## Installation

```sh
yarn -D @shopify/stylelint-polaris stylelint
```

> Note: `stylelint-polaris` requires a peer dependency of `stylelint@>=14.15.0`

## Usage

Extend `@shopify/stylelint-polaris` in your [Stylelint config](https://stylelint.io/user-guide/configure/). Example in `package.json`

```json
{
  "stylelint": {
    "extends": ["@shopify/stylelint-polaris"]
  }
}
```

> IMPORTANT: `@shopify/stylelint-polaris` must be added to the end of the `extends` array

### Run the linter

```sh
npx stylelint '**/*.{css,scss}'
```

### Run the linter and autofix failures

```sh
npx stylelint --fix '**/*.{css,scss}'
```

### Ignoring existing failures

Enabling the linter could result in a large amount of warnings and errors in existing codebases. It is important to fix as many failures upfront as possible, but that shouldn't block the linter from being added. The [styles-insert-stylelint-disable](https://github.com/Shopify/polaris/tree/main/polaris-migrator#v10) migration inserts [ignore comments](https://stylelint.io/user-guide/ignore-code/) so that enabling `stylelint-polaris` can be unblocked.

The migration will insert comments as follows:

```diff
+ // stylelint-disable-next-line -- generated by polaris-migrator DO NOT COPY
padding: 1rem;
```

Run the following command substituting `<path>` with a glob pattern of files to run against:

```sh
npx @shopify/polaris-migrator styles-insert-stylelint-disable <path>
```

## Development

### Add new rules

1. Navigate to the root [`stylelint-polaris` config](index.js)
1. Locate the `stylelint-polaris/coverage` options
1. Identify the appropriate category for the new rule
1. Insert the rule using standard Stylelint [rule configurations](https://stylelint.io/user-guide/configure#rules)

```js
module.exports = {
  rules: {
    'polaris/coverage': {
      colors: {...}, // Standard Stylelint rules config
      layout: {...}, // Standard Stylelint rules config
      motion: {
        'new-rule': 'new-rule-options',
      },
    },
  },
};
```

### Build custom rules

1. Refer to the [Writing plugins](https://stylelint.io/developer-guide/plugins) guide of the Stylelint documentation
1. Create your rule in the [plugins](plugins) directory
1. Validate your plugin with [tests](https://github.com/stylelint/jest-preset-stylelint#usage) (reference sibling plugins for examples)
1. Refer to the [Add new rules](#add-new-rules) section to add your custom rule to the `stylelint-polaris` config

### Add custom messages

Custom messages are surfaced in the command line, CI, and supported editors along side the default `stylelint` rule messages. They are added to the root level config and aim to provide more insight on how to resolve rule violations.

In a majority of cases, the default rule messages are clear and concise. However, they don't always guide developers to a desired outcome. Thus, there are two mechanisms we suggest for improving and providing custom rule messages:

1. Add a generic `message` to the secondary options of a given `stylelint-polaris/coverage` category. This message is appended to the default rule message and we expect will cover most cases.

```js
module.exports = {
  rules: {
    'polaris/coverage': {
      colors: [
        {
          'color-named': 'never'
          'color-no-hex': true,
        },
        {message: 'Please use a Polaris color token: https://polaris.shopify.com/tokens/colors'},
      ],
    },
  },
}
```

Example failure message:

```diff
- Unexpected named color "red" (color-named)
+ Unexpected named color "red" (color-named) Please use a Polaris color token
```

2. Add a custom `message` property in the [rule config's secondary options](https://stylelint.io/user-guide/configure/#message) if supported. This message will be used in place of the default rule message.

```js
module.exports = {
  rules: {
    'polaris/coverage': {
      colors: [
        {
          'color-named': [
            'never',
            {message: 'Unexpected named color. Please refer to this specific page with guidance on how to resolve the failure' },
          ]
          'color-no-hex': true,
        },
        {message: 'Please use a Polaris color token: https://polaris.shopify.com/tokens/colors'},
      ],
    },
  },
}
```

Example failure message:

```diff
- Unexpected value "sticky" for property "position" (declaration-property-value-disallowed-list)
+ Unexpected value "sticky" for property "position" (declaration-property-value-disallowed-list) Please use the Polaris "Sticky" component
```

### Tophat `stylelint-polaris` updates in `polaris-react`

> Open your terminal to the root of the `polaris` monorepo:

1. Install and symlink dependencies

```sh
yarn install
```

2. Build `@shopify/polaris` dependencies, but not `@shopify/polaris` itself

```sh
yarn build -- --filter=@shopify/polaris^...
```

> Note: Remove the `^` character if you do want to build `@shopify/polaris`

3. Run `stylelint` in `polaris-react`

All files

```sh
yarn turbo run lint:styles --filter=@shopify/polaris
```

Specific file

```sh
yarn run stylelint path/to/component.scss

// yarn run stylelint polaris-react/src/components/TopBar/TopBar.scss
```

## Rules

### Conventions

Allows definition of custom properties not prefixed with `--p-`, `--pc-`, or `--polaris-version-`.

#### custom-property-allowed-list

```diff
root: {
- --p-animation-name-drag-handle-pulse: osui_drag-handle-pulse;
};
```

```diff
root: {
+ --osui_animation-name-drag-handle-pulse: osui_drag-handle-pulse;
};
```

Flags declaration property values using `--p-*` that are not valid Polaris tokens.

```diff
- font-size: var(--p-fontsize-200);
```

```diff
+ font-size: var(--p-font-size-200);
```

Flags declaration property values using private `--pc-*` tokens.

```diff
- background: var(--pc-button-color-depressed);

```

```diff
+ background: var(--p-action-secondary-depressed);
```

### Colors

#### color-named

```diff
- color: black;
- fill: dimgray;
```

```diff
+ color: var(--p-text);
+ fill: var(--p-icon)
```

#### color-no-hex

```diff
- color: #202223;
- fill: #5c5f62;
```

```diff
+ color: var(--p-text);
+ fill: var(--p-icon)
```

#### declaration-property-value-disallowed-list

```diff
- background: black;
- opacity: 0.15;
```

```diff
+ background: var(--p-hint-from-direct-light);
```

#### function-disallowed-list

```diff
- color: rgb(140, 145, 150);
- background: color('hover')
```

```diff
+ color: var(--p-text-disabled);
+ background: var(--p-action-secondary-hovered-dark);

```

#### at-rule-disallowed-list

```diff
- fill: recolor-icon(--p-text-subdued);
```

```diff
+ fill: var(--p-icon-subdued);
```

#### global-disallowed-list

Disallows use of legacy custom properties.

```diff
- border: var(--p-override-transparent);
```

```diff
+ border: transparent;
```

Disallows use of legacy mixin map data.

```diff
- @type map $filter-palette-data: $polaris-color-filters;
```

### Motion

#### function-disallowed-list

```diff

```

#### declaration-property-unit-disallowed-list

```diff
- transition-duration: 200ms;
```

```diff
+ transition-duration: var(--p-duration-200);
```

#### at-rule-disallowed-list

```diff

```

#### global-disallowed-list

```diff

```

### Typography

#### declaration-property-value-disallowed-list

```diff

```

#### declaration-property-unit-disallowed-list

```diff
- font-size: 12px;
- line-height: 1.5rem
```

```diff
+ font-size: var(--p-font-size-75);
+ line-height: var(--p-font-line-height-3);
```

#### function-disallowed-list

```diff

```

#### at-rule-disallowed-list

```diff

```

#### property-disallowed-list

```diff

```

### Shape

#### declaration-property-value-disallowed-list

```diff

```

#### declaration-property-unit-disallowed-list

```diff
- border-width: 2px;
- border-radius: 0.5rem;
```

```diff
+ border-width: var(--p-border-width-2);
+ border-radius: var(--p-border-radius-2);
```

#### function-disallowed-list

```diff

```

#### at-rule-disallowed-list

```diff

```

#### property-disallowed-list

```diff

```

### Spacing

#### declaration-property-value-disallowed-list

```diff

```

#### declaration-property-unit-disallowed-list

```diff
- gap: 2px;
- margin: 12px  0;
```

```diff
+ gap: var(--p-space-05);
+ margin: var(--p-space-3) 0;
```

#### function-disallowed-list

```diff

```

#### at-rule-disallowed-list

```diff

```

#### property-disallowed-list

```diff

```

### Depth

#### declaration-property-value-disallowed-list

```diff

```

#### declaration-property-unit-disallowed-list

```diff
- box-shadow: inset 0 0 0 1px var(--p-border-subdued);
```

```diff
+ box-shadow: inset 0 0 0 var(--p-space-025) var(--p-border-subdued);
```

#### function-disallowed-list

```diff

```

#### at-rule-disallowed-list

```diff

```

#### property-disallowed-list

```diff

```

### Media queries

#### function-disallowed-list

```diff

```

#### media-queries-allowed-list

```diff

```

#### at-rule-disallowed-list

```diff

```

### Z-Index

#### declaration-property-value-allowed-list

```diff

```

#### function-disallowed-list

```diff

```

#### global-disallowed-list

```diff

```

### Layout

#### declaration-property-value-disallowed-list

```diff

```

#### function-disallowed-list

```diff

```

#### at-rule-disallowed-list

```diff

```

#### property-disallowed-list

```diff

```

### Legacy

#### at-rule-disallowed-list

```diff

```

#### function-disallowed-list

```diff

```

#### global-disallowed-list

```diff

```

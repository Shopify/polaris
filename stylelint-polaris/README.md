# @shopify/stylelint-polaris

A configuration of Stylelint rules that promote adoption and track coverage of the Polaris design system in consuming apps.

## Installation

```sh
yarn -D @shopify/stylelint-polaris stylelint
```

> Note: `stylelint-polaris` requires a peer dependency of `stylelint@>=14.15.0`

## Usage

Extend `@shopify/stylelint-polaris` in your [Stylelint config](https://stylelint.io/user-guide/configure/). Example in `package.json`

```json
{
  "stylelint": {
    "extends": ["@shopify/stylelint-polaris"]
  }
}
```

> IMPORTANT: `@shopify/stylelint-polaris` must be added to the end of the `extends` array

### Run the linter

```sh
npx stylelint '**/*.{css,scss}'
```

### Run the linter and autofix failures

```sh
npx stylelint --fix '**/*.{css,scss}'
```

### Ignoring existing failures

Enabling the linter could result in a large amount of warnings and errors in existing codebases. It is important to fix as many failures upfront as possible, but that shouldn't block the linter from being added. The [styles-insert-stylelint-disable](https://github.com/Shopify/polaris/tree/main/polaris-migrator#v10) migration inserts [ignore comments](https://stylelint.io/user-guide/ignore-code/) so that enabling `stylelint-polaris` can be unblocked.

The migration will insert comments as follows:

```diff
+ // stylelint-disable-next-line -- generated by polaris-migrator DO NOT COPY
padding: 1rem;
```

Run the following command substituting `<path>` with a glob pattern of files to run against:

```sh
npx @shopify/polaris-migrator styles-insert-stylelint-disable <path>
```

## Development

### Add new rules

1. Navigate to the root [`stylelint-polaris` config](index.js)
1. Locate the `stylelint-polaris/coverage` options
1. Identify the appropriate category for the new rule
1. Insert the rule using standard Stylelint [rule configurations](https://stylelint.io/user-guide/configure#rules)
1. Add documentation for the rule with examples of code that will be reported as a problem and code that will fix the problem
1. The title should be the category + the stylelint rule name, for example `### colors/color-named`

```js
module.exports = {
  rules: {
    'polaris/coverage': {
      colors: {...}, // Standard Stylelint rules config
      layout: {...}, // Standard Stylelint rules config
      motion: {
        'new-rule': 'new-rule-options',
      },
    },
  },
};
```

### Build custom rules

1. Refer to the [Writing plugins](https://stylelint.io/developer-guide/plugins) guide of the Stylelint documentation
1. Create your rule in the [plugins](plugins) directory
1. Validate your plugin with [tests](https://github.com/stylelint/jest-preset-stylelint#usage) (reference sibling plugins for examples)
1. Refer to the [Add new rules](#add-new-rules) section to add your custom rule to the `stylelint-polaris` config

### Add custom messages

Custom messages are surfaced in the command line, CI, and supported editors along side the default `stylelint` rule messages. They are added to the root level config and aim to provide more insight on how to resolve rule violations.

In a majority of cases, the default rule messages are clear and concise. However, they don't always guide developers to a desired outcome. Thus, there are two mechanisms we suggest for improving and providing custom rule messages:

Set a generic custom message on the `message` property of the secondary options of a given `stylelint-polaris/coverage` category. This message is appended to the default rule message and we expect will cover most cases.

```js
module.exports = {
  rules: {
    'polaris/coverage': {
      colors: [
        {
          'color-named': 'never'
          'color-no-hex': true,
        },
        {message: 'Please use a Polaris color token: https://polaris.shopify.com/tokens/colors'},
      ],
    },
  },
}
```

Example failure message:

```diff
- Unexpected named color "red" (color-named)
+ Unexpected named color "red" (color-named) Please use a Polaris color token
```

Set a custom message on the `message` property in the [Stylelint rule config's secondary options](https://stylelint.io/user-guide/configure/#message) if supported. This message is appended to the default rule message instead of the generic category message when provided.

```js
module.exports = {
  rules: {
    'polaris/coverage': {
      layout: [
        {
          'property-disallowed-list': [
            ['position'],
            {message: 'Please use the Polaris "Sticky" component'},
          ],
        },
        {message: 'Please use a Polaris layout component'},
      ],
    },
  },
};
```

Example failure message:

```diff
- Unexpected value "sticky" for property "position" (declaration-property-value-disallowed-list) Please use a Polaris layout component
+ Unexpected value "sticky" for property "position" (declaration-property-value-disallowed-list) Please use the Polaris "Sticky" component
```

### Tophat `stylelint-polaris` updates in `polaris-react`

> Open your terminal to the root of the `polaris` monorepo:

1. Install and symlink dependencies

```sh
yarn install
```

2. Build `@shopify/polaris` dependencies, but not `@shopify/polaris` itself

```sh
yarn build -- --filter=@shopify/polaris^...
```

> Note: Remove the `^` character if you do want to build `@shopify/polaris`

3. Run `stylelint` in `polaris-react`

All files

```sh
yarn turbo run lint:styles --filter=@shopify/polaris
```

Specific file

```sh
yarn run stylelint path/to/component.scss

// yarn run stylelint polaris-react/src/components/TopBar/TopBar.scss
```

## Rules

[Conventions](https://github.com/Shopify/polaris/tree/main/stylelint-polaris/README.md#conventions) |
[Colors](https://github.com/Shopify/polaris/tree/main/stylelint-polaris/README.md#colors) |
[Motion](https://github.com/Shopify/polaris/tree/main/stylelint-polaris/README.md#motion) |
[Typography](https://github.com/Shopify/polaris/tree/main/stylelint-polaris/README.md#typography) |
[Shape](https://github.com/Shopify/polaris/tree/main/stylelint-polaris/README.md#shape) |
[Spacing](https://github.com/Shopify/polaris/tree/main/stylelint-polaris/README.md#shape) |
[Depth](https://github.com/Shopify/polaris/tree/main/stylelint-polaris/README.md#depth) |
[Media queries](https://github.com/Shopify/polaris/tree/main/stylelint-polaris/README.md#media-queries) |
[Z-index](https://github.com/Shopify/polaris/tree/main/stylelint-polaris/README.md#z-index) |
[Layout](https://github.com/Shopify/polaris/tree/main/stylelint-polaris/README.md#layout) |
[Legacy](https://github.com/Shopify/polaris/tree/main/stylelint-polaris/README.md#legacy)

### Conventions

#### conventions/custom-property-allowed-list

Allows definition of custom properties not prefixed with `--p-`, `--pc-`, or `--polaris-version-`.

The following custom property definition is considered a problem:

```diff
root: {
- --p-animation-name-drag-handle-pulse: osui_drag-handle-pulse;
};
```

The following custom property definition is not considered a problem:

```diff
root: {
+ --osui_animation-name-drag-handle-pulse: osui_drag-handle-pulse;
};
```

Flags declaration property values using `--p-*` that are not valid Polaris tokens.

The following invalid token is considered a problem:

```diff
- font-size: var(--p-fontsize-200);
```

The following valid token is not considered a problem:

```diff
+ font-size: var(--p-font-size-200);
```

Flags declaration property values using private `--pc-*` tokens.

The following token value is considered a problem:

```diff
- background: var(--pc-button-color-depressed);
```

The following token value is not considered a problem:

```diff
+ background: var(--p-action-secondary-depressed);
```

### Colors

#### colors/color-named

```diff
- color: black;
- fill: dimgray;
```

```diff
+ color: var(--p-text);
+ fill: var(--p-icon)
```

#### colors/color-no-hex

```diff
- color: #202223;
- fill: #5c5f62;
```

```diff
+ color: var(--p-text);
+ fill: var(--p-icon)
```

#### colors/declaration-property-value-disallowed-list

```diff
- background: black;
- opacity: 0.15;
```

```diff
+ background: var(--p-hint-from-direct-light);
```

#### colors/function-disallowed-list

```diff
- color: rgb(140, 145, 150);
- background: color('hover')
```

```diff
+ color: var(--p-text-disabled);
+ background: var(--p-action-secondary-hovered-dark);

```

#### colors/at-rule-disallowed-list

```diff
- fill: recolor-icon(--p-text-subdued);
```

```diff
+ fill: var(--p-icon-subdued);
```

#### colors/global-disallowed-list

Disallows use of legacy custom properties.

```diff
- border: var(--p-override-transparent);
```

```diff
+ border: transparent;
```

Disallows use of legacy mixin map data.

```diff
- @type map $filter-palette-data: $polaris-color-filters;
```

### Motion

#### motion/function-disallowed-list

```diff

```

#### motion/declaration-property-unit-disallowed-list

```diff
- transition-duration: 200ms;
```

```diff
+ transition-duration: var(--p-duration-200);
```

#### motion/at-rule-disallowed-list

```diff

```

#### motion/global-disallowed-list

```diff

```

### Typography

#### typography/declaration-property-value-disallowed-list

```diff

```

#### typography/declaration-property-unit-disallowed-list

```diff
- font-size: 12px;
- line-height: 1.5rem
```

```diff
+ font-size: var(--p-font-size-75);
+ line-height: var(--p-font-line-height-3);
```

#### typography/function-disallowed-list

```diff

```

#### typography/at-rule-disallowed-list

```diff

```

#### typography/property-disallowed-list

```diff

```

### Shape

#### shape/declaration-property-value-disallowed-list

```diff

```

#### shape/declaration-property-unit-disallowed-list

```diff
- border-width: 2px;
- border-radius: 0.5rem;
```

```diff
+ border-width: var(--p-border-width-2);
+ border-radius: var(--p-border-radius-2);
```

#### shape/function-disallowed-list

```diff

```

#### shape/at-rule-disallowed-list

```diff

```

#### shape/property-disallowed-list

```diff

```

### Spacing

#### spacing/declaration-property-value-disallowed-list

```diff

```

#### spacing/declaration-property-unit-disallowed-list

```diff
- gap: 2px;
- margin: 12px  0;
```

```diff
+ gap: var(--p-space-05);
+ margin: var(--p-space-3) 0;
```

#### spacing/function-disallowed-list

```diff

```

#### spacing/at-rule-disallowed-list

```diff

```

#### spacing/property-disallowed-list

```diff

```

### Depth

#### depth/declaration-property-unit-disallowed-list

Try to use the [Polaris depth tokens](https://polaris.shopify.com/tokens/z-index) before creating your own custom styles.

```diff
// Don't
- box-shadow: 0 1px 0 rgba(0, 0, 0, 0.05);
// Do
+ box-shadow: var(--p-shadow-card);
```

#### depth/function-disallowed-list

Try to use the [Polaris depth tokens](https://polaris.shopify.com/tokens/z-index) before creating your own custom styles.

```diff
// Don't
- filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
// Do
+ box-shadow: var(--p-shadow-base);
```

#### depth/global-disallowed-list

Use the [Polaris depth tokens](https://polaris.shopify.com/tokens/z-index) instead of legacy mixins/variables.

```diff
// Don't
- box-shadow: var(--p-card-shadow);
// Do
+ box-shadow: var(--p-shadow-card);
```

#### depth/property-disallowed-list

Instead of using properties like `text-shadow`, make sure the text has proper contrast with the background so that it is readable without a shadow.

```diff
// Don't
- text-shadow: 2px 2px #ff0000;
```

### Media queries

#### media-queries/function-disallowed-list

Use the [Polaris breakpoint sass variables](https://polaris.shopify.com/tokens/breakpoints#sass-variables) instead of legacy mixins/variables.

```diff
// Don't
- @include breakpoint-after(layout-width(page-with-nav)) {}
// Do
+ @media (min-width: var(--p-breakpoints-md)) {}
```

#### media-queries/media-queries-allowed-list

Try to use the [Polaris breakpoint sass variables](https://polaris.shopify.com/tokens/breakpoints#sass-variables) before creating your own custom styles.

```diff
// Don't
- @include @media #{$my-var} {}
// Do
+ @include @media #{$p-breakpoints-sm-up} {}
```

#### media-queries/at-rule-disallowed-list

Use the [Polaris breakpoint sass variables](https://polaris.shopify.com/tokens/breakpoints#sass-variables) instead of legacy mixins/variables.

```diff
// Don't
- @include breakpoint-before(layout-width(page-with-nav)) {}
// Do
+ @media (max-width: var(--p-breakpoints-md)) {}
```

### Z-Index

#### z-index/declaration-property-value-allowed-list

Try to use the [Polaris z-index tokens](https://polaris.shopify.com/tokens/z-index) before creating your own custom styles.

```diff
// Don't
- z-index: 1;
// Do
+ z-index: var(--p-z-1);
```

#### z-index/function-disallowed-list

Use the [Polaris z-index tokens](https://polaris.shopify.com/tokens/z-index) instead of legacy mixins/variables.

```diff
// Don't
- z-index: z-index(content);
// Do
+ z-index: var(--p-z-1);
```

#### z-index/global-disallowed-list

Use the [Polaris z-index tokens](https://polaris.shopify.com/tokens/z-index) instead of legacy mixins/variables.

```diff
// Don't
- z-index(toast, $fixed-element-stacking-order);
// Do
+ z-index: var(--p-z-1);
```

### Layout

#### layout/declaration-property-value-disallowed-list

There are many ways to use [Polaris components](https://polaris.shopify.com/components) to compose desired layouts. Please explore the layout components before writing custom styles.

```diff
// Don't
- width: 100%;
// Do
+ <Stack />
```

#### layout/function-disallowed-list

Use hard coded pixel or rem values for `width` and `height` instead of legacy mixins/variables or spacing tokens.

```diff
// Don't
- height: top-bar-height();
// Do
+ height: 56px;
```

#### layout/at-rule-disallowed-list

Instead of using a legacy mixin, try and use [Polaris components](https://polaris.shopify.com/components) to compose desired layouts. If what you need isn't possible, either use the mixin's contents or consider contributing to an existing Polaris component.

```diff
// Don't
- @include print-hidden;
// Do
+ @media print {
+   display: none;
+ }
```

#### layout/property-disallowed-list

There are many ways to use [Polaris components](https://polaris.shopify.com/components) to compose desired layouts. Please explore the layout components before writing custom styles.

```diff
// Don't
- display: grid;
// Do
+ <Columns />
```

#### layout/global-disallowed-list

If [Polaris components](https://polaris.shopify.com/components) cannot be composed to create the styles you need, consider contributing to an existing Polaris component before creating custom styles.

```diff
// Don't
- height: var(--p-choice-size);
// Do
+ <Checkbox />
```

### Legacy

#### legacy/at-rule-disallowed-list

If [Polaris components](https://polaris.shopify.com/components) cannot be composed to create the styles you need, consider contributing to an existing Polaris component before creating custom styles.

```diff
// Don't
- @include unstyled-button;
// Do
+ <UnstyledButton />
```

#### legacy/function-disallowed-list

```diff
// Don't
- @include available-names
```

#### legacy/global-disallowed-list

Use [Polaris tokens](https://polaris.shopify.com/tokens) when possible. Otherwise use hard coded pixel or rem values instead of legacy mixins/variables.

```diff
// Don't
- left: -1 * $timeline-border-width;
// Do
+ left: calc(-1 * var(--p-space-1));
```

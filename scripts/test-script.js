const fs = require('fs');
const Octokit = require('@octokit/rest');

const octokit = new Octokit({
  auth: '169307548536e6cea0476d0f6260fe140433a80a',
});

const prList = [
  2628,
  2627,
  2626,
  2625,
  2624,
  2622,
  2618,
  2617,
  2616,
  2612,
  2610,
  2608,
  2607,
  2606,
  2604,
  2603,
  2602,
  2601,
  2600,
  2599,
  2598,
  2595,
  2592,
  2591,
  2590,
  2589,
  2587,
  2584,
  2583,
  2582,
  2628,
  2627,
  2626,
  2625,
  2624,
  2622,
  2618,
  2617,
  2616,
  2612,
  2610,
  2608,
  2607,
  2606,
  2604,
  2603,
  2602,
  2601,
  2600,
  2599,
  2598,
  2595,
  2592,
  2591,
  2590,
  2589,
  2587,
  2584,
  2583,
  2582,
  2581,
  2579,
  2576,
  2574,
  2573,
  2572,
  2571,
  2570,
  2569,
  2568,
  2567,
  2565,
  2564,
  2563,
  2562,
  2561,
  2560,
  2558,
  2557,
  2556,
  2555,
  2554,
  2553,
  2552,
  2551,
  2550,
  2549,
  2548,
  2547,
  2546,
  2545,
  2544,
  2543,
  2542,
  2541,
  2540,
  2539,
  2538,
  2537,
  2536,
  2535,
  2534,
  2532,
  2530,
  2529,
  2528,
  2527,
  2524,
  2523,
  2522,
  2521,
  2520,
  2519,
  2518,
  2517,
  2516,
  2515,
  2514,
  2513,
  2512,
  2511,
  2510,
  2509,
  2508,
  2507,
  2506,
  2505,
  2504,
  2503,
  2502,
  2501,
  2500,
  2499,
  2496,
  2494,
  2491,
  2489,
  2486,
  2485,
  2484,
  2482,
  2478,
  2477,
  2476,
  2474,
  2473,
  2472,
  2471,
  2469,
  2468,
  2467,
  2466,
  2465,
  2464,
  2462,
  2461,
  2459,
  2455,
  2454,
  2453,
  2452,
  2451,
  2450,
  2449,
  2448,
  2447,
  2445,
  2444,
  2443,
  2441,
  2440,
  2438,
  2437,
  2436,
  2435,
  2434,
  2433,
  2432,
  2431,
  2429,
  2428,
  2427,
  2424,
  2423,
  2420,
  2419,
  2418,
  2417,
  2416,
  2415,
  2414,
  2413,
  2412,
  2411,
  2410,
  2409,
  2408,
  2407,
  2406,
  2405,
  2404,
  2403,
  2402,
  2401,
  2399,
  2398,
  2397,
  2395,
  2392,
  2391,
  2389,
  2386,
  2385,
  2384,
  2382,
  2381,
  2379,
  2377,
  2376,
  2375,
  2373,
  2372,
  2370,
  2369,
  2368,
  2367,
  2366,
  2365,
  2364,
  2362,
  2361,
  2360,
  2359,
  2358,
  2356,
  2355,
  2354,
  2353,
  2352,
  2351,
  2350,
  2348,
  2347,
  2346,
  2345,
  2344,
  2343,
  2342,
  2341,
  2340,
  2339,
  2337,
  2336,
  2335,
  2334,
  2330,
  2329,
  2328,
  2327,
  2326,
  2325,
  2323,
  2322,
  2321,
  2320,
  2319,
  2318,
  2317,
  2315,
  2313,
  2312,
  2311,
  2309,
  2308,
  2307,
  2306,
  2305,
  2303,
  2301,
  2300,
  2298,
  2297,
  2295,
  2292,
  2291,
  2290,
  2289,
  2288,
  2287,
  2285,
  2284,
  2283,
  2281,
  2279,
  2278,
  2277,
  2276,
  2275,
  2273,
  2269,
  2268,
  2266,
  2265,
  2262,
  2261,
  2259,
  2258,
  2257,
  2256,
  2255,
  2254,
  2253,
  2252,
  2248,
  2246,
  2244,
  2243,
  2242,
  2241,
  2240,
  2239,
  2238,
  2237,
  2235,
  2234,
  2233,
  2232,
  2231,
  2230,
  2229,
  2228,
  2227,
  2225,
  2224,
  2223,
  2222,
  2219,
  2218,
  2217,
  2216,
  2215,
  2211,
  2210,
  2209,
  2208,
  2207,
  2206,
  2204,
  2203,
  2202,
  2200,
  2196,
  2195,
  2193,
  2192,
  2191,
  2189,
  2186,
  2185,
  2181,
];

async function getNumbers(page) {
  let end = false;
  const prPage = await octokit.pulls.list({
    owner: 'Shopify',
    repo: 'polaris-react',
    state: 'all',
    page,
  });

  const numbers = prPage.data.map((pr) => {
    if (pr.number === 2216) {
      end = true;
    }
    return pr.number;
  });

  console.log(page);
  console.log(numbers, end);

  return end ? numbers : [...numbers, ...(await getNumbers(page + 1))];
}

function sleep(ms) {
  return new Promise((resolve) => setTimeout(resolve, ms));
}

async function main() {
  let bigJSON = '';
  for (const number of prList) {
    await sleep(1000);
    const comments = await octokit.issues.listComments({
      owner: 'Shopify',
      repo: 'polaris-react',
      issue_number: number,
    });
    console.log('new pr', number);
    bigJSON = `${bigJSON}

    ${JSON.stringify(comments, null, 2)}`;
  }

  fs.writeFile(
    './bigJSON.json',
    bigJSON,
    {
      spaces: 2,
    },
    () => {
      console.log(`âœ… big json dumped`);
    },
  );
}

main();

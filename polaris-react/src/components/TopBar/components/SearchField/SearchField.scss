@import '../../../../styles/common';
@import '../../variables';

$icon-size: 20px;
$new-input-height: 36px;
$search-icon-width: calc(#{$icon-size} + var(--p-space-4));

$icon-size-se23: 18px;
$new-input-height-se23: 32px;
$search-icon-width-se23: calc(#{$icon-size-se23} + var(--p-space-3));

.SearchField {
  // stylelint-disable -- Polaris component custom properties
  --pc-search-field-backdrop: 1;
  --pc-search-field-input: 2;
  --pc-search-field-icon: 3;
  --pc-search-field-action: 3;
  // stylelint-enable
  z-index: var(--p-z-index-11);
  position: relative;
  display: flex;
  flex: 1 1 auto;
  align-items: center;
  border: var(--p-border-width-1) solid transparent;
  width: 100%;
  max-width: $search-max-width;
}
// We have both a focused class and a focus pseudo selector here
// because we allow "faked" focus for when the search is still
// active, but is not actually the focused element in the DOM
// (for example, while selecting a value from a filter in the
// search this input controls)
.focused .Input,
.Input:focus {
  border: none;
  color: var(--p-color-text);

  #{$se23} & {
    color: var(--p-color-text-inverse);
  }

  &::placeholder {
    color: var(--p-color-text-subdued);

    #{$se23} & {
      color: var(--p-color-text-inverse-subdued);
    }
  }
}

.Input:focus-visible:not(:active) {
  // stylelint-disable-next-line selector-max-specificity -- needed for se23
  ~ .Backdrop {
    // stylelint-disable-next-line -- generated by polaris-migrator DO NOT COPY
    @include focus-ring($style: 'focused');

    #{$se23} & {
      outline: var(--p-border-width-2) solid
        var(--p-color-border-interactive-focus);
      outline-offset: var(--p-space-05);
    }
  }

  // stylelint-disable-next-line selector-max-specificity -- needed for se23
  ~ .BackdropShowFocusBorder {
    // stylelint-disable-next-line -- generated by polaris-migrator DO NOT COPY
    border: var(--p-border-width-1) solid var(--pc-top-bar-border);
  }

  // stylelint-disable-next-line -- generated by polaris-migrator DO NOT COPY
  ~ .Icon svg {
    fill: var(--p-color-icon);

    #{$se23} & {
      fill: var(--p-color-icon-subdued);
    }
  }
}

.focused {
  .BackdropShowFocusBorder {
    // stylelint-disable-next-line -- generated by polaris-migrator DO NOT COPY
    border: var(--p-border-width-1) solid var(--pc-top-bar-border);
  }

  // stylelint-disable-next-line -- generated by polaris-migrator DO NOT COPY
  .Icon svg {
    fill: var(--p-color-icon);

    #{$se23} & {
      fill: var(--p-color-icon-inverse);
    }
  }
}

.Input {
  // stylelint-disable-next-line -- generated by polaris-migrator DO NOT COPY
  @include text-style-input;
  // stylelint-disable-next-line -- generated by polaris-migrator DO NOT COPY
  z-index: var(--pc-search-field-input);
  height: $new-input-height;
  width: 100%;
  padding: 0 0 0 $search-icon-width;
  border: none;
  background-color: transparent;
  outline: none;
  color: var(--p-color-text);
  will-change: fill, color;
  transition: fill var(--p-motion-duration-200) var(--p-motion-ease),
    color var(--p-motion-duration-200) var(--p-motion-ease);
  appearance: textfield;

  #{$se23} & {
    padding: 0 $search-icon-width-se23 0 $search-icon-width-se23;
    color: var(--p-color-text-inverse-subdued);
    height: $new-input-height-se23;
    border: var(--p-border-width-1-experimental) solid
      var(--p-color-border-inverse);
    border-radius: var(--p-border-radius-2);

    &:hover {
      border-color: var(--p-color-border-hover);
    }

    &:active,
    &:focus {
      box-shadow: inset 0 0 0 var(--p-border-width-1) var(--p-color-border);
    }
  }

  &::placeholder {
    color: var(--p-color-text);

    #{$se23} & {
      color: var(--p-color-text-inverse-subdued);
    }
  }

  &::-webkit-search-decoration,
  &::-webkit-search-cancel-button {
    appearance: none;
  }
}

.Icon {
  position: absolute;
  // stylelint-disable-next-line -- generated by polaris-migrator DO NOT COPY
  z-index: var(--pc-search-field-icon);
  top: 50%;
  left: var(--p-space-2);
  display: flex;
  height: $icon-size;
  pointer-events: none;
  transform: translateY(-50%);

  #{$se23} & {
    height: $icon-size-se23;
    width: $icon-size-se23;
  }

  svg {
    fill: var(--p-color-icon);

    #{$se23} & {
      fill: var(--p-color-icon-subdued);
    }
  }
}

.Clear {
  // stylelint-disable-next-line -- generated by polaris-migrator DO NOT COPY
  @include focus-ring($size: 'wide');
  position: relative;
  // stylelint-disable-next-line -- generated by polaris-migrator DO NOT COPY
  z-index: var(--pc-search-field-action);
  border: none;
  appearance: none;
  background: transparent;
  padding: var(--p-space-2);

  #{$se23} & {
    position: absolute;
    right: var(--p-space-1);
    padding: var(--p-space-1);
  }

  svg {
    fill: var(--p-color-icon);

    #{$se23} & {
      fill: var(--p-color-icon-subdued);
    }
  }

  &:focus,
  &:hover {
    outline: none;
  }

  &:hover svg,
  &:focus svg {
    fill: var(--p-color-icon-hover);

    #{$se23} & {
      fill: var(--p-color-icon-inverse);
    }
  }

  &:focus-visible {
    // stylelint-disable-next-line -- generated by polaris-migrator DO NOT COPY
    @include focus-ring($size: 'wide', $style: 'focused');
  }

  &:active {
    svg {
      fill: var(--p-color-icon-active);
    }

    &::after {
      border: none;
    }
  }
}

.Backdrop {
  // stylelint-disable-next-line -- generated by polaris-migrator DO NOT COPY
  @include focus-ring;
  position: absolute;
  // stylelint-disable-next-line -- generated by polaris-migrator DO NOT COPY
  z-index: var(--pc-search-field-backdrop);
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  background-color: var(--p-color-bg-inset);
  border-radius: var(--p-border-radius-1);

  #{$se23} & {
    /* stylelint-disable-next-line polaris/border/polaris/at-rule-disallowed-list -- se23 overrides */
    @include no-focus-ring;
    background-color: var(--p-color-bg-inset-strong);
    border-radius: var(--p-border-radius-2);
  }
}

# This workflow warns and then closes issues and PRs that have had no activity for a specified amount of time.
#
# You can adjust the behavior by modifying this file.
# For more information, see:
# https://github.com/actions/stale
name: Mark stale issues and pull requests

on:
  schedule:
    - cron: '31 3 * * *' # randomly chosen time of day
  workflow_dispatch:

jobs:
  stale:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      pull-requests: write

    steps:
      - uses: actions/stale@v4
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          days-before-issue-stale: 180
          days-before-pr-stale: 180
          days-before-close: 30
          stale-issue-message: |-
            Hi there! It looks like there hasn't been any activity on this issue in a while. If it's still relevant, we'd love to hear from you! Please leave a comment letting us know and we'll be happy to take a look.

            If you don't have any updates or this is no longer relevant, no worries - just take no action. Please note that if there's no activity within 30 days, the issue will be automatically closed. But don't worry, you can always reopen it if needed.

            Thanks for contributing to Polaris!
          stale-pr-message: |-
            Hi there! It looks like there hasn't been any activity on this PR in a while. If it's still relevant, we'd love to hear from you! Please leave a comment letting us know and we'll be happy to take a look.

            If you don't have any updates or this is no longer relevant, no worries - just take no action. Please note that if there's no activity within 30 days, the PR will be automatically closed. But don't worry, you can always reopen it if needed.

            Thanks for contributing to Polaris!
          stale-issue-label: 'no-issue-activity'
          stale-pr-label: 'no-pr-activity'
          ascending: true
          # The math seems a bit fuzzy, but this should amount to a max of 50 issues daily.
          # But then the same issues get checked first so we don't end up progressing too quickly until we can close what we started.
          # Hopefully https://github.com/actions/stale/issues/692 will be closed and fix some of this mess.
          operations-per-run: 200
